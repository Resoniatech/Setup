import{u as ne,_ as ue,N as de}from"./CardCodeExample-xcIUe0pG.js";import{$ as ce,a as B,b as pe,c as ve,d as ge}from"./MallList-BNeY_iJP.js";import{A as R}from"./path-BZD2o_vV.js";import{i as fe,j as n,T as F,S as me,y as he,k as A,b as a,u as o,h as ye,w as r,o as j,U as we,l as g,B as v,p as f,q as Z,N as H,P as p,E as De,G as be,_ as Ce}from"./index-BLhrQPID.js";import{N as U}from"./InputNumber-D6mA97Ob.js";import{N as J,b as Pe}from"./Upload-CY7awFlj.js";import{N as u}from"./FormItem-Bx6x5kZc.js";import{N as P}from"./Input-BN6wvFhZ.js";import{N as O}from"./Form-DnSKBLLB.js";import{N as G}from"./DatePicker-8nNUJjFF.js";import"./RadioGroup-C9CuaTMP.js";import"./Select-CGduaRNo.js";import"./download-sglA049O.js";import"./request-CS5nCZLh.js";import"./Add-DDiTrC_i.js";import"./typeof-QjJsDpFa.js";import"./defineProperty-DJACW-dl.js";const W=I=>(De("data-v-6da4f3dd"),I=I(),be(),I),Ie={class:"page"},ke={key:0,class:"overlay"},xe={id:"drawer-target",style:{position:"relative",width:"100%",overflow:"hidden","z-index":"0"}},Se={class:"flex justify-between flex-col md:flex-row md:gap-4"},Ne=W(()=>g("svg",{xmlns:"http://www.w3.org/2000/svg",height:"20px",viewBox:"0 -960 960 960",width:"24px",fill:"#5f6368"},[g("path",{d:"M440-122q-121-15-200.5-105.5T160-440q0-66 26-126.5T260-672l57 57q-38 34-57.5 79T240-440q0 88 56 155.5T440-202v80Zm80 0v-80q87-16 143.5-83T720-440q0-100-70-170t-170-70h-3l44 44-56 56-140-140 140-140 56 56-44 44h3q134 0 227 93t93 227q0 121-79.5 211.5T520-122Z"})],-1)),_e=W(()=>g("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"20px",fill:"rgb(255,255,255)"},[g("path",{d:"M440-440H200v-80h240v-240h80v240h240v80H520v240h-80v-240Z"})],-1)),Te={style:{display:"flex","flex-direction":"column"}},Ue={style:{display:"flex","flex-direction":"column"}},Ee=fe({__name:"MallList",setup(I){const E=n(!1),k=F({page:1,pageSize:5,pageSlot:3,showSizePicker:!0,pageSizes:[5,10,15],onChange:l=>{k.page=l},onUpdatePageSize:l=>{k.pageSize=l,k.page=1}}),Y=[{title:"商品图片",key:"imageUrl",render:l=>p("div",{style:{width:window.innerWidth<=768?"80px":"100px",height:"auto",display:"flex",justifyContent:"center",alignItems:"center"}},[p(Pe,{src:l.ImageUrl,width:"100%",height:"auto",objectFit:"cover",alt:"Product Image"})])},{title:"商品標題",key:"title",render:l=>p("div",{style:"white-space: nowrap;"},l.Title)},{title:"類別",key:"category",render:l=>p("div",{style:"white-space: nowrap;"},l.Category)},{title:"原價",key:"price",render:l=>p("div",{style:"white-space: nowrap;"},l.Price)},{title:"折扣價",key:"discountPrice",render:l=>p("div",{style:"white-space: nowrap;"},l.DiscountPrice)},{title:"開始日期",key:"dateStart",render:l=>p("div",{style:"white-space: nowrap;"},l.DateStart)},{title:"結束日期",key:"dateEnd",render:l=>p("div",{style:"white-space: nowrap;"},l.DateEnd)},{title:"Action",key:"actions",render:(l,e)=>[p(v,{onClick:()=>te("Edit",l,e),size:"small",style:"margin-right: 8px; color: white; background-color: blue;"},()=>"編輯"),p(v,{onClick:()=>re("Delete",l,e),size:"small",style:"color: white; background-color: red;"},()=>"刪除")]}],x=n([]),y=async()=>{try{let l=await ce();l.success?(E.value=!0,x.value=l.data.map(e=>(e.DateStart=e.DateStart.substring(0,10),e.DateEnd=e.DateEnd.substring(0,10),e)),console.log(x.value),q.value=x.value,E.value=!1):c.error("失敗")}catch(l){console.log(l)}},L=n(null),w=n(!1),c=me(),d=n({Title:"",Category:"",Price:0,DiscountPrice:0,DateStart:"",DateEnd:""}),K={Title:{required:!0,message:"請輸入商品標題",trigger:["input"]},Category:{required:!0,message:"請輸入類別",trigger:["input"]},Price:{required:!0,type:"number",message:"請輸入原價",trigger:["input"]},DiscountPrice:{required:!0,type:"number",message:"請輸入折扣價",trigger:["input"]}},S=n([Date.now(),Date.now()]),$=n([]),N=F({url:""}),Q=async l=>{if(l.length===0){console.log("No files to process.");return}const e=l[0].file;if(!e){console.log("No file available to upload.");return}const i=new FormData;i.append("file",e);let t=await B(i);console.log(t),t.success?(console.log(t.data),N.url=`${R}${t.data}`,console.log(N.url),$.value[0]={status:"finished",url:N.url}):console.error("Failed to upload file:",t)},M=l=>{console.log(l)},z=l=>{console.log("File removed:",l),m.value=[]};function _(l){const e=new Date(l),i=e.getFullYear(),t=(e.getMonth()+1).toString().padStart(2,"0"),T=e.getDate().toString().padStart(2,"0");return`${i}-${t}-${T}`}function X(l){var e;l.preventDefault(),(e=L.value)==null||e.validate(async i=>{if(i)console.log(i),c.error("Invalid");else try{const t=JSON.parse(sessionStorage.getItem("loginInfo")||"{}");if(console.log(t),!t.Id)return;console.log(t.Id);const T=_(S.value[0]),ie=_(S.value[1]);(await pe({Title:d.value.Title,Category:d.value.Category,Price:d.value.Price,DiscountPrice:d.value.DiscountPrice,DateStart:T,DateEnd:ie,ImageUrl:N.url,UserId:t.Id,IsDeleted:!1,DeletedAt:null})).success?(c.success("成功"),y()):c.error("失敗")}catch(t){console.log(t)}})}const D=n(!1);n(!1),n("right");const V=n(null),m=n([]),b=F({url:""}),ee=async l=>{if(l.length===0){console.log("No files to process.");return}console.log(l[l.length-1]);const e=l[l.length-1].file;if(console.log(m.value),!e){console.log("No file available to upload.");return}const i=new FormData;i.append("file",e);let t=await B(i);t.success?(b.url=`${R}${t.data}`,m.value[0]={status:"finished",url:b.url}):console.error("Failed to upload file:",t)},s=n({Title:"",Category:"",Price:0,DiscountPrice:0,DateStart:"",DateEnd:""}),C=n([Date.now(),Date.now()]),te=(l,e,i)=>{console.log(e),console.log("點擊",`${l}`,`${i}`),c.info(`Editing List: ${e.Title}`),D.value=!0,s.value.Id=e.Id,s.value.Title=e.Title,s.value.Category=e.Category,s.value.Price=e.Price,s.value.DiscountPrice=e.DiscountPrice,C.value=[new Date(e.DateStart).getTime(),new Date(e.DateEnd).getTime()],b.url=e.ImageUrl,m.value[0]={status:"finished",url:b.url}},le={Title:{required:!0,message:"請輸入商品標題",trigger:["input"]},Category:{required:!0,message:"請輸入類別",trigger:["input"]},Price:{required:!0,type:"number",message:"請輸入原價",trigger:["input"]},DiscountPrice:{required:!0,type:"number",message:"請輸入折扣價",trigger:["input"]}},ae=l=>{var e;console.log("333"),l.preventDefault(),(e=V.value)==null||e.validate(async i=>{if(i)console.log(i),c.error("Invalid");else try{const t=JSON.parse(sessionStorage.getItem("loginInfo")||"{}");if(console.log(t),!t.Id){console.log("Edit111");return}console.log("Edit"),(await ve({Id:s.value.Id,Title:s.value.Title,Category:s.value.Category,Price:s.value.Price,DiscountPrice:s.value.DiscountPrice,DateStart:_(C.value[0]),DateEnd:_(C.value[1]),ImageUrl:b.url,userId:t.Id})).success?(c.success("編輯成功"),y()):c.error("編輯失敗")}catch(t){console.log(t)}})},oe=ne(),re=(l,e,i)=>{console.log("點擊",`${l}`,`${i}`),oe.error({title:"警告",content:"確定刪除?",positiveText:"確定",negativeText:"不確定",onPositiveClick:async()=>{try{if(e.Id===void 0){c.error("商品 ID 缺失，無法刪除");return}(await ge(e.Id)).success?(c.success("刪除成功"),y()):c.error("刪除失敗")}catch(t){console.log(t)}},onNegativeClick:()=>{c.error("不確定")}})},q=n([]),h=n(""),se=()=>{console.log("搜尋：",h.value);const l=h.value.toLowerCase();q.value=x.value.filter(e=>e.Title.includes(l)||e.Category.toLowerCase().includes(l)||e.Price.toString().includes(h.value)||e.DiscountPrice.toString().includes(h.value)||e.DateStart.toLowerCase().includes(l)||e.DateEnd.toLowerCase().includes(l))};return y(),he(()=>{}),(l,e)=>{const i=ue;return j(),A("div",Ie,[E.value?(j(),A("div",ke,[a(o(we),{show:""})])):ye("",!0),a(i,{title:"編輯商品",ref:"card"},{default:r(()=>[g("div",xe,[g("div",Se,[a(o(u),{label:"搜尋:",path:"search",class:"basis-1/3","label-placement":"left"},{default:r(()=>[a(o(P),{placeholder:"請輸入..",value:h.value,"onUpdate:value":e[0]||(e[0]=t=>h.value=t)},null,8,["value"]),a(o(v),{style:{"margin-left":"10px"},onClick:se},{default:r(()=>[f("確認")]),_:1}),a(o(v),{style:{"margin-left":"10px"},onClick:y},{default:r(()=>[Ne]),_:1})]),_:1}),a(o(v),{onClick:e[1]||(e[1]=t=>w.value=!0),class:"basis-1/8",style:{"background-color":"blue",color:"white","margin-bottom":"10px !important"}},{default:r(()=>[f(" 新增商品 "),_e]),_:1})]),a(o(de),{columns:Y,data:q.value,pagination:k},null,8,["data","pagination"]),a(o(Z),{show:w.value,"onUpdate:show":e[10]||(e[10]=t=>w.value=t)},{default:r(()=>[a(o(H),{style:{width:"500px","background-color":"white"},title:"新增商品",bordered:!1,size:"huge",role:"dialog","aria-modal":"true",closable:"",onClose:e[9]||(e[9]=t=>w.value=!1)},{default:r(()=>[a(o(O),{ref_key:"formRef",ref:L,inline:"","label-width":80,model:d.value,rules:K},{default:r(()=>[g("div",Te,[a(o(u),{label:"商品標題",path:"title"},{default:r(()=>[a(o(P),{value:d.value.Title,"onUpdate:value":e[2]||(e[2]=t=>d.value.Title=t),placeholder:"請輸入.."},null,8,["value"])]),_:1}),a(o(u),{label:"類別",path:"category"},{default:r(()=>[a(o(P),{value:d.value.Category,"onUpdate:value":e[3]||(e[3]=t=>d.value.Category=t),placeholder:"請輸入.."},null,8,["value"])]),_:1}),a(o(u),{label:"原價",path:"price"},{default:r(()=>[a(o(U),{value:d.value.Price,"onUpdate:value":e[4]||(e[4]=t=>d.value.Price=t),placeholder:"請輸入..",class:"w-full",min:"0"},null,8,["value"])]),_:1}),a(o(u),{label:"折扣價",path:"discountPrice"},{default:r(()=>[a(o(U),{value:d.value.DiscountPrice,"onUpdate:value":e[5]||(e[5]=t=>d.value.DiscountPrice=t),placeholder:"請輸入..",class:"w-full",min:"0"},null,8,["value"])]),_:1}),a(o(u),{label:"折扣期間",path:"daterange"},{default:r(()=>[a(o(G),{value:S.value,"onUpdate:value":e[6]||(e[6]=t=>S.value=t),type:"daterange",clearable:""},null,8,["value"])]),_:1}),a(o(u),{path:"name",label:"上傳圖片"},{default:r(()=>[a(o(J),{"list-type":"image-card","file-list":$.value,"onUpdate:fileList":e[7]||(e[7]=t=>$.value=t),"on-update:file-list":Q,"on-finish":M,"on-remove":z},{default:r(()=>[f(" Click to Upload ")]),_:1},8,["file-list"])]),_:1}),a(o(u),null,{default:r(()=>[a(o(v),{onClick:X},{default:r(()=>[f(" 確認 ")]),_:1}),a(o(v),{style:{"margin-left":"5px"},onClick:e[8]||(e[8]=t=>w.value=!1)},{default:r(()=>[f(" 取消 ")]),_:1})]),_:1})])]),_:1},8,["model"])]),_:1})]),_:1},8,["show"]),a(o(Z),{show:D.value,"onUpdate:show":e[19]||(e[19]=t=>D.value=t)},{default:r(()=>[a(o(H),{style:{width:"500px","background-color":"white"},title:"編輯商品",bordered:!1,size:"huge",role:"dialog","aria-modal":"true",closable:"",onClose:e[18]||(e[18]=t=>D.value=!1)},{default:r(()=>[a(o(O),{ref_key:"editFormRef",ref:V,inline:"","label-width":80,model:s.value,rules:le},{default:r(()=>[g("div",Ue,[a(o(u),{label:"商品標題",path:"title"},{default:r(()=>[a(o(P),{value:s.value.Title,"onUpdate:value":e[11]||(e[11]=t=>s.value.Title=t),placeholder:"請輸入.."},null,8,["value"])]),_:1}),a(o(u),{label:"類別",path:"category"},{default:r(()=>[a(o(P),{value:s.value.Category,"onUpdate:value":e[12]||(e[12]=t=>s.value.Category=t),placeholder:"請輸入.."},null,8,["value"])]),_:1}),a(o(u),{label:"原價",path:"price"},{default:r(()=>[a(o(U),{value:s.value.Price,"onUpdate:value":e[13]||(e[13]=t=>s.value.Price=t),placeholder:"請輸入..",class:"w-full",min:"0"},null,8,["value"])]),_:1}),a(o(u),{label:"折扣價",path:"discountPrice"},{default:r(()=>[a(o(U),{value:s.value.DiscountPrice,"onUpdate:value":e[14]||(e[14]=t=>s.value.DiscountPrice=t),placeholder:"請輸入..",class:"w-full",min:"0"},null,8,["value"])]),_:1}),a(o(u),{label:"折扣期間",path:"daterange",class:"basis-1/2"},{default:r(()=>[a(o(G),{value:C.value,"onUpdate:value":e[15]||(e[15]=t=>C.value=t),type:"daterange",clearable:""},null,8,["value"])]),_:1}),a(o(u),{path:"name",label:"修改圖片",class:"basis-1/2"},{default:r(()=>[a(o(J),{"list-type":"image-card","file-list":m.value,"onUpdate:fileList":e[16]||(e[16]=t=>m.value=t),"on-update:file-list":ee,"on-finish":M,"on-remove":z},null,8,["file-list"])]),_:1}),a(o(u),null,{default:r(()=>[a(o(v),{onClick:ae},{default:r(()=>[f(" 確認 ")]),_:1}),a(o(v),{style:{"margin-left":"5px"},onClick:e[17]||(e[17]=t=>D.value=!1)},{default:r(()=>[f(" 取消 ")]),_:1})]),_:1})])]),_:1},8,["model"])]),_:1})]),_:1},8,["show"])])]),_:1},512)])}}}),Ke=Ce(Ee,[["__scopeId","data-v-6da4f3dd"]]);export{Ke as default};
