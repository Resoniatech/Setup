import{i as R,bN as z,j as v,S as I,bO as N,o as p,c as P,w as d,b as r,u as t,bP as h,l as g,p as x,B as S,bQ as O,s as E,bR as L,k as w,ad as F,h as y,n as T,ac as D,_ as B,t as A,bS as V,bu as j,bT as M}from"./index-BLhrQPID.js";import{a as K}from"./request-CS5nCZLh.js";import{N as k}from"./Input-BN6wvFhZ.js";import{N as U}from"./FormItem-Bx6x5kZc.js";import{N as q}from"./Form-DnSKBLLB.js";import{S as J}from"./Settings-BQI2KhPI.js";import"./path-BZD2o_vV.js";const H=async f=>{try{return console.log(f),await K("/api/Account/Login",f)}catch{return console.log("error"),!1}},Q={class:"flex flex-col items-end gap-6"},G={class:"flex justify-end w-full"},W={class:"w-full"},X=R({__name:"SignIn",emits:["forgot-password"],setup(f,{emit:n}){const a=z(),i=v(null),s=I(),o=v({User_Email:"",User_Password:""}),m=n,l={User_Email:[{required:!0,trigger:["blur"],message:"請輸入User_Email"}],User_Password:[{required:!0,trigger:["blur"],message:"請輸入密碼"},{min:4,trigger:["blur"],message:"最少4位數密碼"}]},c=N(),e=async u=>{var _;u.preventDefault(),(_=i.value)==null||_.validate(async b=>{if(b)s.error("請輸入帳號密碼登入");else try{let C=await H({User_Email:o.value.User_Email,User_Password:o.value.User_Password});if(C.success){sessionStorage.setItem("loginInfo",JSON.stringify(C.data)),sessionStorage.setItem("token",JSON.stringify(C.token)),c.setLogged();const $=JSON.parse(sessionStorage.getItem("loginInfo")||"{}");console.log($),$.User_Role==="管理員"?(a.push({path:"/homePage",replace:!0}),console.log($.Role)):$.User_Role==="顧客"?a.push({path:"/marketingManagement/mallPreview",replace:!0}):$.User_Role==="經銷商"&&a.push({path:"/homePage",replace:!0})}else s.error("信箱或密碼錯誤，登入失敗")}catch{s.error("Login failed due to server error")}})};return(u,_)=>(p(),P(t(q),{ref_key:"formRef",ref:i,model:o.value,rules:l},{default:d(()=>[r(t(U),{path:"User_Email",label:"電子郵件信箱"},{default:d(()=>[r(t(k),{value:o.value.User_Email,"onUpdate:value":_[0]||(_[0]=b=>o.value.User_Email=b),onKeydown:h(e,["enter"]),placeholder:"Example@email.com",size:"large",autocomplete:"on"},null,8,["value"])]),_:1}),r(t(U),{path:"User_Password",label:"密碼"},{default:d(()=>[r(t(k),{value:o.value.User_Password,"onUpdate:value":_[1]||(_[1]=b=>o.value.User_Password=b),type:"password","show-password-on":"click",placeholder:"最少4位數密碼",onKeydown:h(e,["enter"]),autocomplete:"on",size:"large"},null,8,["value"])]),_:1}),g("div",Q,[g("div",G,[r(t(S),{text:"",type:"primary",onClick:_[2]||(_[2]=b=>m("forgot-password"))},{default:d(()=>[x("忘記密碼?")]),_:1})]),g("div",W,[r(t(S),{type:"primary",onClick:e,onKeydown:h(e,["enter"]),class:"!w-full",size:"large"},{default:d(()=>[x("登入")]),_:1})])])]),_:1},8,["model"]))}}),Y=async f=>{try{return console.log(f),await K("/api/SendMail/SendForgetPassword",f)}catch{return console.log("error"),!1}},Z={class:"flex flex-col items-end gap-6"},ee={class:"w-full"},se=R({__name:"ForgotPassword",setup(f){const n=v(null),a=I(),i=v({email:""}),s={email:[{required:!0,validator:(m,l)=>l?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l)?!0:new Error("請輸入有效的電子信箱郵件"):new Error("請輸入電子信箱郵件"),trigger:["input"]}]};function o(m){var l;m.preventDefault(),(l=n.value)==null||l.validate(async c=>{if(c)a.error("請輸入正確信箱");else try{console.log(i.value.email),(await Y({email:i.value.email})).success?a.success("寄送成功，請到信箱收信"):a.error("無此信箱")}catch{a.error("信箱錯誤")}})}return(m,l)=>(p(),P(t(q),{ref_key:"formRef",ref:n,model:i.value,rules:s},{default:d(()=>[r(t(U),{path:"email",label:"Email"},{default:d(()=>[r(t(k),{value:i.value.email,"onUpdate:value":l[0]||(l[0]=c=>i.value.email=c),onKeydown:h(o,["enter"]),placeholder:"Example@email.com",size:"large"},null,8,["value"])]),_:1}),g("div",Z,[g("div",ee,[r(t(S),{type:"primary",onClick:o,class:"!w-full",size:"large"},{default:d(()=>[x("寄送重設連結")]),_:1})])])]),_:1},8,["model"]))}}),ae={class:"flex flex-col items-end"},oe={class:"w-full"},te=R({__name:"SignUp",setup(f){const n=z(),a=v(null),i=I(),s=v({email:"admin@admin.com",password:"password",confirmPassword:"password"}),o={email:[{required:!0,trigger:["blur"],message:"Email is required"}],password:[{required:!0,trigger:["blur"],message:"Password is required"}],confirmPassword:[{required:!0,trigger:["blur"],message:"confirmPassword is required"},{validator:(c,e)=>e===s.value.password,message:"Password is not same as re-entered password!",trigger:["blur","password-input"]}]},m=N();function l(c){var e;c.preventDefault(),(e=a.value)==null||e.validate(u=>{u?i.error("Invalid credentials"):s.value.email==="admin@admin.com"&&s.value.password==="password"?(m.setLogged(),n.push({path:"/",replace:!0})):i.error("Invalid credentials")})}return(c,e)=>(p(),P(t(q),{ref_key:"formRef",ref:a,model:s.value,rules:o},{default:d(()=>[r(t(U),{path:"email",label:"Email"},{default:d(()=>[r(t(k),{value:s.value.email,"onUpdate:value":e[0]||(e[0]=u=>s.value.email=u),onKeydown:h(l,["enter"]),size:"large",placeholder:"Example@email.com"},null,8,["value"])]),_:1}),r(t(U),{path:"password",label:"Password"},{default:d(()=>[r(t(k),{value:s.value.password,"onUpdate:value":e[1]||(e[1]=u=>s.value.password=u),type:"password",onKeydown:h(l,["enter"]),size:"large","show-password-on":"click",placeholder:"At least 8 characters"},null,8,["value"])]),_:1}),r(t(U),{path:"confirmPassword",label:"Confirm Password",first:""},{default:d(()=>[r(t(k),{value:s.value.confirmPassword,"onUpdate:value":e[2]||(e[2]=u=>s.value.confirmPassword=u),type:"password",disabled:!s.value.password,onKeydown:h(l,["enter"]),size:"large","show-password-on":"click",placeholder:"At least 8 characters"},null,8,["value","disabled"])]),_:1}),g("div",ae,[g("div",oe,[r(t(S),{type:"primary",onClick:l,class:"!w-full",size:"large"},{default:d(()=>[x("Create an account")]),_:1})])])]),_:1},8,["model"]))}}),re={class:"form-wrap"},le={key:1,class:"title mb-4",style:{"font-size":"30px"}},ne={class:"form"},ie={class:"sign-text text-center mt-4"},ue={key:0,class:"sign-text"},de={key:1,class:"sign-text"},ce=R({__name:"index",props:{type:{},useOnlyRouter:{type:Boolean}},setup(f){const n=f,a=v("signin"),i=z(),s=O();E(()=>s.isThemeDark);const o=E(()=>a.value==="signin"?"滙律科技":a.value==="signup"?"Hello":"忘記密碼");function m(){n.useOnlyRouter||(a.value="signin"),i.replace({name:"Login"})}function l(){n.useOnlyRouter||(a.value="forgotpassword"),i.replace({name:"ForgotPassword"})}return L(()=>{n.type&&(a.value=n.type)}),(c,e)=>(p(),w("div",re,[o.value=="忘記密碼"?(p(),w("div",{key:0,class:"title mb-4",style:F([{"white-space":"nowrap"},{fontSize:o.value==="忘記密碼"?"36px":"24px"}])}," 滙律科技｜水資源管理系統 ",4)):y("",!0),g("div",{class:"title mb-2",style:F({fontSize:o.value==="忘記密碼"?"24px":"36px"})},T(o.value),5),o.value=="滙律科技"?(p(),w("div",le," 水資源管理系統 ")):y("",!0),g("div",ne,[r(D,{name:"form-fade",mode:"out-in",appear:""},{default:d(()=>[a.value==="signin"?(p(),P(X,{key:"signin",onForgotPassword:e[0]||(e[0]=u=>l())})):a.value==="forgotpassword"?(p(),P(se,{key:"forgotpassword"})):a.value==="signup"?(p(),P(te,{key:"signup"})):y("",!0)]),_:1})]),g("div",ie,[a.value==="forgotpassword"?(p(),w("div",ue,[r(t(S),{text:"",onClick:e[1]||(e[1]=u=>m()),type:"primary",size:"large"},{default:d(()=>[x("返回登入頁面")]),_:1})])):y("",!0),a.value==="signup"?(p(),w("div",de,[x(" Do you have an account? "),r(t(S),{text:"",onClick:e[2]||(e[2]=u=>m()),type:"primary",size:"large"},{default:d(()=>[x("Sign in")]),_:1})])):y("",!0)])]))}}),pe=B(ce,[["__scopeId","data-v-f94b4165"]]),me={class:"page-auth"},fe={class:"flex wrapper justify-center"},ge={key:0,class:"image-box basis-2/3"},ve={key:1,class:"image-box basis-2/3"},_e=R({__name:"Login",props:{formType:{}},setup(f){M(c=>({b56d8cc8:o.value})),console.log("到login頁面");const n=f,{formType:a}=A(n),i=V(),s=v("left"),o=v(""),m=v(a.value||void 0),l=N();return E(()=>l.isLogged),L(()=>{if(i.query.step){const c=i.query.step;m.value=c}}),(c,e)=>(p(),w("div",me,[r(J,{align:s.value,"onUpdate:align":e[0]||(e[0]=u=>s.value=u),activeColor:o.value,"onUpdate:activeColor":e[1]||(e[1]=u=>o.value=u)},null,8,["align","activeColor"]),g("div",fe,[s.value==="right"?(p(),w("div",ge)):y("",!0),g("div",{class:j(["form-box basis-1/3 flex items-center justify-center",{centered:s.value==="center"}])},[r(pe,{type:m.value},null,8,["type"])],2),s.value==="left"?(p(),w("div",ve)):y("",!0)])]))}}),Ue=B(_e,[["__scopeId","data-v-985fda31"]]);export{Ue as default};
